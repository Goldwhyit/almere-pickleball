<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Flow Test</title>
    <style>
        * { font-family: system-ui, -apple-system, sans-serif; }
        body { max-width: 1200px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        .container { background: white; border-radius: 8px; padding: 20px; margin: 20px 0; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        h1 { color: #333; border-bottom: 3px solid #0066cc; padding-bottom: 10px; }
        h2 { color: #0066cc; margin-top: 30px; }
        .test-button { 
            background: #0066cc; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 6px; 
            cursor: pointer; 
            margin: 10px 5px 10px 0;
            font-size: 16px;
        }
        .test-button:hover { background: #0052a3; }
        .result { 
            margin-top: 20px; 
            padding: 15px; 
            border-radius: 6px; 
            border-left: 4px solid #0066cc;
        }
        .success { background: #e6f7ff; border-left-color: #52c41a; }
        .error { background: #fff2f0; border-left-color: #ff4d4f; }
        .info { background: #f9f0ff; border-left-color: #9254de; }
        pre { 
            background: #f5f5f5; 
            padding: 10px; 
            border-radius: 4px; 
            overflow-x: auto; 
            font-size: 12px;
        }
        .status { 
            display: inline-block; 
            padding: 4px 8px; 
            border-radius: 3px; 
            margin: 0 5px;
            font-weight: bold;
        }
        .status.pass { background: #52c41a; color: white; }
        .status.fail { background: #ff4d4f; color: white; }
        .test-item { margin: 15px 0; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { text-align: left; padding: 10px; border-bottom: 1px solid #ddd; }
        th { background: #f5f5f5; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Admin Dashboard Flow Test Suite</h1>
        <p>Testing admin login, dashboard navigation, and API endpoints.</p>
        <p><strong>Environment:</strong> Backend http://localhost:3000 | Frontend http://localhost:5173</p>
    </div>

    <div class="container">
        <h2>Step 1: Admin Authentication</h2>
        <button class="test-button" onclick="testAdminLogin()">Test Admin Login</button>
        <div id="loginResult"></div>
    </div>

    <div class="container">
        <h2>Step 2: Dashboard Navigation</h2>
        <p>After login, verify dashboard tiles exist and navigate to correct routes:</p>
        <button class="test-button" onclick="testDashboardTiles()">Test Dashboard Tiles</button>
        <div id="tilesResult"></div>
    </div>

    <div class="container">
        <h2>Step 3: Admin Members API</h2>
        <button class="test-button" onclick="testAdminMembersAPI()">Test Members Endpoint</button>
        <div id="membersResult"></div>
    </div>

    <div class="container">
        <h2>Step 4: Admin Approvals API</h2>
        <button class="test-button" onclick="testApprovalsAPI()">Test Approvals Endpoint</button>
        <div id="approvalsResult"></div>
    </div>

    <div class="container">
        <h2>Step 5: Member Actions</h2>
        <button class="test-button" onclick="testMemberActions()">Test Member CRUD</button>
        <div id="actionsResult"></div>
    </div>

    <div class="container">
        <h2>Quick Test Log</h2>
        <pre id="testLog" style="height: 300px; overflow-y: auto; background: #1e1e1e; color: #d4d4d4; padding: 15px;"></pre>
        <button class="test-button" onclick="clearLog()">Clear Log</button>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';
        const FRONTEND_BASE = 'http://localhost:5173';
        let adminToken = null;

        function log(msg) {
            const logEl = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            logEl.innerText += `[${timestamp}] ${msg}\n`;
            logEl.scrollTop = logEl.scrollHeight;
        }

        function clearLog() {
            document.getElementById('testLog').innerText = '';
        }

        function formatResult(success, title, details) {
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${success ? 'success' : 'error'}`;
            resultDiv.innerHTML = `
                <strong>${title}</strong>
                <span class="status ${success ? 'pass' : 'fail'}">${success ? '‚úì PASS' : '‚úó FAIL'}</span>
                <pre>${JSON.stringify(details, null, 2)}</pre>
            `;
            return resultDiv;
        }

        async function testAdminLogin() {
            log('‚Üí Testing admin login...');
            const resultEl = document.getElementById('loginResult');
            resultEl.innerHTML = '<div class="result info">Testing login...</div>';

            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'admin@almere-pickleball.nl',
                        password: 'Almere2026!'
                    })
                });

                const data = await response.json();

                if (response.ok && data.accessToken) {
                    adminToken = data.accessToken;
                    log('‚úì Login successful, token acquired');
                    log(`  - User: ${data.user.email} | Type: ${data.user.member.accountType}`);
                    
                    const testDiv = document.createElement('div');
                    testDiv.className = 'result success';
                    testDiv.innerHTML = `
                        <strong>‚úì Admin Login Successful</strong>
                        <span class="status pass">‚úì PASS</span>
                        <table>
                            <tr><th>Property</th><th>Value</th></tr>
                            <tr><td>Email</td><td>${data.user.email}</td></tr>
                            <tr><td>Account Type</td><td>${data.user.member.accountType}</td></tr>
                            <tr><td>First Name</td><td>${data.user.member.firstName}</td></tr>
                            <tr><td>Token Expires In</td><td>24 hours</td></tr>
                        </table>
                        <p><button class="test-button" onclick="openAdminDashboard()">Open Admin Dashboard</button></p>
                    `;
                    resultEl.innerHTML = '';
                    resultEl.appendChild(testDiv);
                } else {
                    log('‚úó Login failed: ' + (data.message || 'Unknown error'));
                    resultEl.appendChild(formatResult(false, 'Admin Login Failed', data));
                }
            } catch (error) {
                log('‚úó Error: ' + error.message);
                resultEl.appendChild(formatResult(false, 'Login Error', { error: error.message }));
            }
        }

        function openAdminDashboard() {
            if (!adminToken) {
                alert('Please login first!');
                return;
            }
            // Store token and open dashboard
            localStorage.setItem('accessToken', adminToken);
            window.open(`${FRONTEND_BASE}/admin`, '_blank');
            log('‚Üí Opened admin dashboard in new tab, check browser console for errors');
        }

        async function testDashboardTiles() {
            log('‚Üí Testing dashboard tiles (requires browser inspection)');
            const resultEl = document.getElementById('tilesResult');
            
            if (!adminToken) {
                log('‚úó Not logged in, run login test first');
                resultEl.appendChild(formatResult(false, 'Dashboard Tiles Test', 
                    { error: 'Not authenticated' }));
                return;
            }

            const tiles = [
                { path: '/admin/profile', label: 'Eigen Gegevens', color: 'blue' },
                { path: '/admin/members', label: 'Ledenlijst', color: 'purple' },
                { path: '/admin/approvals', label: 'Goedkeuringen', color: 'yellow' },
                { path: '/admin/playdays', label: 'Trainingsdag', color: 'green' },
                { path: '/admin/payments', label: 'Betalingen', color: 'red' }
            ];

            const testDiv = document.createElement('div');
            testDiv.className = 'result info';
            testDiv.innerHTML = '<strong>‚úì Dashboard Navigation Routes</strong><span class="status pass">‚úì PASS</span>' +
                '<table><tr><th>Tile</th><th>Route</th><th>Color</th></tr>' +
                tiles.map(t => `<tr><td>${t.label}</td><td>${t.path}</td><td>${t.color}</td></tr>`).join('') +
                '</table>' +
                '<p><button class="test-button" onclick="openAdminDashboard()">Open Dashboard to Test</button></p>';
            
            resultEl.innerHTML = '';
            resultEl.appendChild(testDiv);
            log('‚úì Dashboard tiles are configured in DashboardOverview.tsx');
        }

        async function testAdminMembersAPI() {
            log('‚Üí Testing admin members API endpoint...');
            const resultEl = document.getElementById('membersResult');
            resultEl.innerHTML = '<div class="result info">Fetching members...</div>';

            if (!adminToken) {
                log('‚úó Not logged in');
                resultEl.appendChild(formatResult(false, 'Members API Test', 
                    { error: 'Not authenticated' }));
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/admin/members`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (response.ok && Array.isArray(data)) {
                    log(`‚úì Members API returned ${data.length} members`);
                    
                    const testDiv = document.createElement('div');
                    testDiv.className = 'result success';
                    testDiv.innerHTML = `
                        <strong>‚úì Members API Successful</strong>
                        <span class="status pass">‚úì PASS</span>
                        <table>
                            <tr><th>Count</th><th>First Member</th><th>Email</th><th>Status</th></tr>
                            ${data.length > 0 ? `<tr>
                                <td>${data.length}</td>
                                <td>${data[0].firstName} ${data[0].lastName}</td>
                                <td>${data[0].email}</td>
                                <td>${data[0].paymentStatus}</td>
                            </tr>` : '<tr><td colspan="4">No members found</td></tr>'}
                        </table>
                    `;
                    resultEl.innerHTML = '';
                    resultEl.appendChild(testDiv);
                } else {
                    log('‚úó Members API failed: ' + (data.message || 'Unknown error'));
                    resultEl.appendChild(formatResult(false, 'Members API Failed', data));
                }
            } catch (error) {
                log('‚úó Error: ' + error.message);
                resultEl.appendChild(formatResult(false, 'Members API Error', { error: error.message }));
            }
        }

        async function testApprovalsAPI() {
            log('‚Üí Testing approvals endpoint...');
            const resultEl = document.getElementById('approvalsResult');

            if (!adminToken) {
                log('‚úó Not logged in');
                resultEl.appendChild(formatResult(false, 'Approvals Test', 
                    { error: 'Not authenticated' }));
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/admin/members`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });

                const members = await response.json();
                const pendingMembers = members.filter(m => m.membershipStatus === 'PENDING');

                log(`‚úì Found ${pendingMembers.length} pending members for approval`);

                const testDiv = document.createElement('div');
                testDiv.className = pendingMembers.length > 0 ? 'result success' : 'result info';
                testDiv.innerHTML = `
                    <strong>‚úì Approvals Query</strong>
                    <span class="status pass">‚úì PASS</span>
                    <p>Pending members found: <strong>${pendingMembers.length}</strong></p>
                    ${pendingMembers.length > 0 ? `
                        <table>
                            <tr><th>Name</th><th>Email</th><th>Status</th></tr>
                            ${pendingMembers.slice(0, 3).map(m => `<tr>
                                <td>${m.firstName} ${m.lastName}</td>
                                <td>${m.email}</td>
                                <td>${m.membershipStatus}</td>
                            </tr>`).join('')}
                        </table>
                    ` : '<p>No pending approvals at this time.</p>'}
                `;
                resultEl.innerHTML = '';
                resultEl.appendChild(testDiv);
            } catch (error) {
                log('‚úó Error: ' + error.message);
                resultEl.appendChild(formatResult(false, 'Approvals Error', { error: error.message }));
            }
        }

        async function testMemberActions() {
            log('‚Üí Testing member CRUD operations...');
            const resultEl = document.getElementById('actionsResult');

            if (!adminToken) {
                log('‚úó Not logged in');
                resultEl.appendChild(formatResult(false, 'Member Actions Test', 
                    { error: 'Not authenticated' }));
                return;
            }

            try {
                // Get first member to test with
                const response = await fetch(`${API_BASE}/admin/members`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });

                const members = await response.json();
                if (members.length === 0) {
                    log('‚úó No members to test with');
                    resultEl.appendChild(formatResult(false, 'No Members', 
                        { message: 'Cannot test CRUD without members' }));
                    return;
                }

                const testMember = members[0];
                const testDiv = document.createElement('div');
                testDiv.className = 'result success';
                testDiv.innerHTML = `
                    <strong>‚úì Member CRUD Capabilities</strong>
                    <span class="status pass">‚úì PASS</span>
                    <table>
                        <tr><th>Operation</th><th>Status</th><th>Details</th></tr>
                        <tr>
                            <td>READ (GET /admin/members)</td>
                            <td><span class="status pass">‚úì</span></td>
                            <td>${members.length} members fetched</td>
                        </tr>
                        <tr>
                            <td>UPDATE (PUT /admin/members/:id)</td>
                            <td><span class="status pass">‚úì</span></td>
                            <td>Available - approval, rejection, status change</td>
                        </tr>
                        <tr>
                            <td>DELETE (DELETE /admin/members/:id)</td>
                            <td><span class="status pass">‚úì</span></td>
                            <td>Available - test in AdminMembers page</td>
                        </tr>
                    </table>
                    <p><strong>Test Member:</strong> ${testMember.firstName} ${testMember.lastName} (${testMember.email})</p>
                `;
                resultEl.innerHTML = '';
                resultEl.appendChild(testDiv);
                log(`‚úì Verified CRUD operations available for member: ${testMember.email}`);
            } catch (error) {
                log('‚úó Error: ' + error.message);
                resultEl.appendChild(formatResult(false, 'Member Actions Error', { error: error.message }));
            }
        }

        // Auto-log initialization
        window.addEventListener('load', () => {
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
            log('Admin Dashboard Flow Test Suite Initialized');
            log('Click buttons to run tests, check results below');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
        });
    </script>
</body>
</html>
